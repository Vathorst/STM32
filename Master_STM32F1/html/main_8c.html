<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Master Code STM32F1: Core/Src/main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Master Code STM32F1
   &#160;<span id="projectnumber">Release</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('main_8c.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">main.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>: Main program body  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="main_8h_source.html">main.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__module.html">t_module</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct used for separating screen and slave module.  <a href="structt__module.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga37c4c48ff47f0838f64b5a1fb3c803b2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___mode___select.html#ga37c4c48ff47f0838f64b5a1fb3c803b2">HALF</a>&#160;&#160;&#160;&quot;180\n&quot;</td></tr>
<tr class="separator:ga37c4c48ff47f0838f64b5a1fb3c803b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf9c1faad7448f0a38fbf00c4fabd96ee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___mode___select.html#gaf9c1faad7448f0a38fbf00c4fabd96ee">HALF_NUM</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:gaf9c1faad7448f0a38fbf00c4fabd96ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5c617053fd20a3bae198334dc6ac09d1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___mode___select.html#ga5c617053fd20a3bae198334dc6ac09d1">FULL_NUM</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ga5c617053fd20a3bae198334dc6ac09d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf79b86055d2cf03d459c6502eb4fdc2b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___mode___select.html#gaf79b86055d2cf03d459c6502eb4fdc2b">MANUAL_GPIO</a>&#160;&#160;&#160;GPIOA</td></tr>
<tr class="separator:gaf79b86055d2cf03d459c6502eb4fdc2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaec4a2161ba32afaf290f6a1ef9903c7e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___mode___select.html#gaec4a2161ba32afaf290f6a1ef9903c7e">MANUAL_PIN</a>&#160;&#160;&#160;GPIO_PIN_0</td></tr>
<tr class="separator:gaec4a2161ba32afaf290f6a1ef9903c7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafa79cee4bc998a7804af1a3169b095f0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___used___peripherials.html#gafa79cee4bc998a7804af1a3169b095f0">SCHERM_UART</a>&#160;&#160;&#160;huart2</td></tr>
<tr class="separator:gafa79cee4bc998a7804af1a3169b095f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4e019eaeae6edb6e0cf18ef7284de198"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___used___peripherials.html#ga4e019eaeae6edb6e0cf18ef7284de198">SLAVE_UART</a>&#160;&#160;&#160;huart1</td></tr>
<tr class="separator:ga4e019eaeae6edb6e0cf18ef7284de198"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab911ad79166ddb3b57718c1c9165a78d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___used___peripherials.html#gab911ad79166ddb3b57718c1c9165a78d">MSG_TIM</a>&#160;&#160;&#160;htim1</td></tr>
<tr class="separator:gab911ad79166ddb3b57718c1c9165a78d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac1619442929fedce3c9378dd3eb01bfb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___used___peripherials.html#gac1619442929fedce3c9378dd3eb01bfb">LED_TIM</a>&#160;&#160;&#160;htim2</td></tr>
<tr class="separator:gac1619442929fedce3c9378dd3eb01bfb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e53751a27267574b92f23d01951a259"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___timing___definitions.html#ga5e53751a27267574b92f23d01951a259">ACK_TIMEOUT</a>&#160;&#160;&#160;1000</td></tr>
<tr class="separator:ga5e53751a27267574b92f23d01951a259"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3c15658c410376370604187eb2b5562b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___timing___definitions.html#ga3c15658c410376370604187eb2b5562b">SCORE_DELAY</a>&#160;&#160;&#160;10000</td></tr>
<tr class="separator:ga3c15658c410376370604187eb2b5562b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8cfe47a626c35a858e809a41829a2cd4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___timing___definitions.html#ga8cfe47a626c35a858e809a41829a2cd4">START_TIME</a>&#160;&#160;&#160;5000</td></tr>
<tr class="separator:ga8cfe47a626c35a858e809a41829a2cd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad29ebde3c8bd7568e2e1e7d32bf7a3f3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___timing___definitions.html#gad29ebde3c8bd7568e2e1e7d32bf7a3f3">TIME_INCREMENT</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:gad29ebde3c8bd7568e2e1e7d32bf7a3f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga59749d915719383f0f61588ca8da0a94"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___timing___definitions.html#ga59749d915719383f0f61588ca8da0a94">NEXT_BT_TIME</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:ga59749d915719383f0f61588ca8da0a94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga997bb3a60c98e24f915d9b7b6c179a3a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_e_d___commands.html#ga997bb3a60c98e24f915d9b7b6c179a3a">LED_BLINK</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:ga997bb3a60c98e24f915d9b7b6c179a3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafa3a1cd44351e5baf3f4520aa5444a18"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_e_d___commands.html#gafa3a1cd44351e5baf3f4520aa5444a18">LED_TOGGLE</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:gafa3a1cd44351e5baf3f4520aa5444a18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf2e697ac60e05813d45ea2c9c9e79c25"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_e_d___commands.html#gaf2e697ac60e05813d45ea2c9c9e79c25">LED_ON</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:gaf2e697ac60e05813d45ea2c9c9e79c25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga80700bb63bd56ebabbb4728aa433fd29"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_e_d___commands.html#ga80700bb63bd56ebabbb4728aa433fd29">LED_OFF</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga80700bb63bd56ebabbb4728aa433fd29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga00160bb8ea6d6ce3765dbb30885aea98"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___buffer___indexes.html#ga00160bb8ea6d6ce3765dbb30885aea98">SCHERM_I</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ga00160bb8ea6d6ce3765dbb30885aea98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga751ebf6e960b88228073fcc2685257ef"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___buffer___indexes.html#ga751ebf6e960b88228073fcc2685257ef">SLAVE_I</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga751ebf6e960b88228073fcc2685257ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga41c7fcbe209a1c236fd1b8e35bd8b55a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___l_e_d___pin___definitions.html#ga41c7fcbe209a1c236fd1b8e35bd8b55a">BLUE_LED</a>&#160;&#160;&#160;((uint16_t)0x2000)</td></tr>
<tr class="separator:ga41c7fcbe209a1c236fd1b8e35bd8b55a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:aa0aafed44fec19806d8f9ad834be1248"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248">state_t</a> { <br />
&#160;&#160;<a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248a42aba49f19261d75ae58e7907b76334b">STATE_STR</a>, 
<a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248a3c9186548a739b26d367651c0d99e70a">STATE_ADR</a>, 
<a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248a4822b1312afe6d98ef995e4fb9779391">STATE_CHS</a>, 
<a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248a26b6d341015457541c9eaf6fb742531c">STATE_CTR</a>, 
<br />
&#160;&#160;<a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248adceebbc176186b2bbeb1b53731478bcd">STATE_ERR</a>, 
<a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248af3f9f84c5967b769ca17cdc6c523f7fe">STATE_END</a>
<br />
 }</td></tr>
<tr class="memdesc:aa0aafed44fec19806d8f9ad834be1248"><td class="mdescLeft">&#160;</td><td class="mdescRight">The various states that the master module can be in.  <a href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248">More...</a><br /></td></tr>
<tr class="separator:aa0aafed44fec19806d8f9ad834be1248"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a70af21c671abfcc773614a9a4f63d920"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a70af21c671abfcc773614a9a4f63d920">SystemClock_Config</a> (void)</td></tr>
<tr class="memdesc:a70af21c671abfcc773614a9a4f63d920"><td class="mdescLeft">&#160;</td><td class="mdescRight">System Clock Configuration.  <a href="main_8c.html#a70af21c671abfcc773614a9a4f63d920">More...</a><br /></td></tr>
<tr class="separator:a70af21c671abfcc773614a9a4f63d920"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b8685f844049dcf93a7257fd76c81c"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a50b8685f844049dcf93a7257fd76c81c">CheckTimeout</a> (const char *valid_ans, int timeout)</td></tr>
<tr class="memdesc:a50b8685f844049dcf93a7257fd76c81c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function will be called when a message is expected. Used to verify the answer received from the slave module. Also uses a timer to check for a timeout.  <a href="main_8c.html#a50b8685f844049dcf93a7257fd76c81c">More...</a><br /></td></tr>
<tr class="separator:a50b8685f844049dcf93a7257fd76c81c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76f45df70ed53a2b4c17aa3c60fff0d1"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a76f45df70ed53a2b4c17aa3c60fff0d1">SendMessage</a> (const char *msg)</td></tr>
<tr class="memdesc:a76f45df70ed53a2b4c17aa3c60fff0d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message to the slaves and waits for an acknowledge.  <a href="main_8c.html#a76f45df70ed53a2b4c17aa3c60fff0d1">More...</a><br /></td></tr>
<tr class="separator:a76f45df70ed53a2b4c17aa3c60fff0d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af75e49c23f7837b52a29915a0cf91208"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#af75e49c23f7837b52a29915a0cf91208">SendCommand</a> (const char *cmd, const char *ans, int timeout)</td></tr>
<tr class="memdesc:af75e49c23f7837b52a29915a0cf91208"><td class="mdescLeft">&#160;</td><td class="mdescRight">Expanded version of the SendMessage command. This command calls SendMessage and if that succeeded calls CheckTimout. The user inputs what command they want to send, what answer they expect and how long to wait for a timeout.  <a href="main_8c.html#af75e49c23f7837b52a29915a0cf91208">More...</a><br /></td></tr>
<tr class="separator:af75e49c23f7837b52a29915a0cf91208"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a720d1625c6409023659f9515ce44d6e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a720d1625c6409023659f9515ce44d6e1">SetLed</a> (uint16_t led_pin, uint8_t state)</td></tr>
<tr class="memdesc:a720d1625c6409023659f9515ce44d6e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to control the LEDs using global defines. Mostly useful for the blinking functionality. This activates a timer that will turn the LED off after 100ms. This makes it so LEDs can blink without halting the execution of the program.  <a href="main_8c.html#a720d1625c6409023659f9515ce44d6e1">More...</a><br /></td></tr>
<tr class="separator:a720d1625c6409023659f9515ce44d6e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a775aad1a1ae286c9785d2cbfd135663d"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a775aad1a1ae286c9785d2cbfd135663d">CheckMsg</a> ()</td></tr>
<tr class="memdesc:a775aad1a1ae286c9785d2cbfd135663d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the screen sent a message. Also checks if a manual pin has been pulled down. Will activate the mastermodule's protocol.  <a href="main_8c.html#a775aad1a1ae286c9785d2cbfd135663d">More...</a><br /></td></tr>
<tr class="separator:a775aad1a1ae286c9785d2cbfd135663d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840291bc02cba5474a4cb46a9b9566fe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a> (void)</td></tr>
<tr class="memdesc:a840291bc02cba5474a4cb46a9b9566fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">The application entry point.  <a href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">More...</a><br /></td></tr>
<tr class="separator:a840291bc02cba5474a4cb46a9b9566fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae494a9643f29b87d6d81e5264e60e57b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#ae494a9643f29b87d6d81e5264e60e57b">HAL_UART_RxCpltCallback</a> (UART_HandleTypeDef *huart)</td></tr>
<tr class="memdesc:ae494a9643f29b87d6d81e5264e60e57b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when a character is received from a uart. This char is stored as an array of rx_buff, with an index of 1. Will put the char in the correct buffer and check if the message is complete. Will reactivate the uart after char is handled.  <a href="main_8c.html#ae494a9643f29b87d6d81e5264e60e57b">More...</a><br /></td></tr>
<tr class="separator:ae494a9643f29b87d6d81e5264e60e57b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1730ffe1e560465665eb47d9264826f9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a1730ffe1e560465665eb47d9264826f9">Error_Handler</a> (void)</td></tr>
<tr class="memdesc:a1730ffe1e560465665eb47d9264826f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is executed in case of error occurrence.  <a href="main_8c.html#a1730ffe1e560465665eb47d9264826f9">More...</a><br /></td></tr>
<tr class="separator:a1730ffe1e560465665eb47d9264826f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a25fc663547539bc49fecc0011bd76ab5"><td class="memItemLeft" align="right" valign="top"><a id="a25fc663547539bc49fecc0011bd76ab5"></a>
TIM_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>htim1</b></td></tr>
<tr class="separator:a25fc663547539bc49fecc0011bd76ab5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c80fd5510e2990a59a5c90d745c716c"><td class="memItemLeft" align="right" valign="top"><a id="a2c80fd5510e2990a59a5c90d745c716c"></a>
TIM_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>htim2</b></td></tr>
<tr class="separator:a2c80fd5510e2990a59a5c90d745c716c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cf715bef37f7e8ef385a30974a5f0d5"><td class="memItemLeft" align="right" valign="top"><a id="a2cf715bef37f7e8ef385a30974a5f0d5"></a>
UART_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>huart1</b></td></tr>
<tr class="separator:a2cf715bef37f7e8ef385a30974a5f0d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9479c261d65eecedd3d9582f7f0f89c"><td class="memItemLeft" align="right" valign="top"><a id="aa9479c261d65eecedd3d9582f7f0f89c"></a>
UART_HandleTypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>huart2</b></td></tr>
<tr class="separator:aa9479c261d65eecedd3d9582f7f0f89c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ad1b3c04a7af5e5219bfa1a17bb838a"><td class="memItemLeft" align="right" valign="top"><a id="a4ad1b3c04a7af5e5219bfa1a17bb838a"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a4ad1b3c04a7af5e5219bfa1a17bb838a">rx_buff</a> [1]</td></tr>
<tr class="memdesc:a4ad1b3c04a7af5e5219bfa1a17bb838a"><td class="mdescLeft">&#160;</td><td class="mdescRight">rx_buff contains the incoming char <br /></td></tr>
<tr class="separator:a4ad1b3c04a7af5e5219bfa1a17bb838a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31895faa3f888363fa7986d7d88e0b80"><td class="memItemLeft" align="right" valign="top"><a id="a31895faa3f888363fa7986d7d88e0b80"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#a31895faa3f888363fa7986d7d88e0b80">blink_pin</a></td></tr>
<tr class="memdesc:a31895faa3f888363fa7986d7d88e0b80"><td class="mdescLeft">&#160;</td><td class="mdescRight">blink_pin tells LED timer which pin to turn off <br /></td></tr>
<tr class="separator:a31895faa3f888363fa7986d7d88e0b80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc57ce7041029359f6061fd99547e5d2"><td class="memItemLeft" align="right" valign="top"><a id="acc57ce7041029359f6061fd99547e5d2"></a>
<a class="el" href="structt__module.html">t_module</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8c.html#acc57ce7041029359f6061fd99547e5d2">m_buff</a> [2]</td></tr>
<tr class="memdesc:acc57ce7041029359f6061fd99547e5d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">m_buff are the two buffers for screen/slave message handling <br /></td></tr>
<tr class="separator:acc57ce7041029359f6061fd99547e5d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>: Main program body </p>
<dl class="section attention"><dt>Attention</dt><dd></dd></dl>
<h2><center>&copy; Copyright (c) 2021 STMicroelectronics. All rights reserved.</center></h2>
<p>This software component is licensed by ST under BSD 3-Clause license, the "License"; You may not use this file except in compliance with the License. You may obtain a copy of the License at: opensource.org/licenses/BSD-3-Clause </p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="aa0aafed44fec19806d8f9ad834be1248"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0aafed44fec19806d8f9ad834be1248">&#9670;&nbsp;</a></span>state_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="main_8c.html#aa0aafed44fec19806d8f9ad834be1248">state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The various states that the master module can be in. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="aa0aafed44fec19806d8f9ad834be1248a42aba49f19261d75ae58e7907b76334b"></a>STATE_STR&#160;</td><td class="fielddoc"><p>Start State <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="aa0aafed44fec19806d8f9ad834be1248a3c9186548a739b26d367651c0d99e70a"></a>STATE_ADR&#160;</td><td class="fielddoc"><p>Addressing State <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="aa0aafed44fec19806d8f9ad834be1248a4822b1312afe6d98ef995e4fb9779391"></a>STATE_CHS&#160;</td><td class="fielddoc"><p>Choosing State <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="aa0aafed44fec19806d8f9ad834be1248a26b6d341015457541c9eaf6fb742531c"></a>STATE_CTR&#160;</td><td class="fielddoc"><p>Control and Verify State <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="aa0aafed44fec19806d8f9ad834be1248adceebbc176186b2bbeb1b53731478bcd"></a>STATE_ERR&#160;</td><td class="fielddoc"><p>Error State <br  />
 </p>
</td></tr>
<tr><td class="fieldname"><a id="aa0aafed44fec19806d8f9ad834be1248af3f9f84c5967b769ca17cdc6c523f7fe"></a>STATE_END&#160;</td><td class="fielddoc"><p>Ending State <br  />
 </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a775aad1a1ae286c9785d2cbfd135663d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a775aad1a1ae286c9785d2cbfd135663d">&#9670;&nbsp;</a></span>CheckMsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char CheckMsg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the screen sent a message. Also checks if a manual pin has been pulled down. Will activate the mastermodule's protocol. </p>
<dl class="section pre"><dt>Precondition</dt><dd>The screen UART has to be turned on </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>none </dd></dl>
<dl class="section return"><dt>Returns</dt><dd>HALF_NUM if the message was "180\n", FULL_NUM in every other case. </dd></dl>

</div>
</div>
<a id="a50b8685f844049dcf93a7257fd76c81c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50b8685f844049dcf93a7257fd76c81c">&#9670;&nbsp;</a></span>CheckTimeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char CheckTimeout </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>valid_ans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function will be called when a message is expected. Used to verify the answer received from the slave module. Also uses a timer to check for a timeout. </p>
<dl class="section pre"><dt>Precondition</dt><dd>Message has been sent that requires a reply. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Answer has been received and verified. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">valid_ans</td><td>The expected answer for the slave module. </td></tr>
    <tr><td class="paramname">timeout</td><td>The time the slave has to give an answer. Uses increments of 100ms. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns a non-zero character if correct message arrived in time. Returns zero if the message was incorrect or it didn't arrive in time. </dd></dl>

</div>
</div>
<a id="a1730ffe1e560465665eb47d9264826f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1730ffe1e560465665eb47d9264826f9">&#9670;&nbsp;</a></span>Error_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Error_Handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is executed in case of error occurrence. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae494a9643f29b87d6d81e5264e60e57b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae494a9643f29b87d6d81e5264e60e57b">&#9670;&nbsp;</a></span>HAL_UART_RxCpltCallback()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HAL_UART_RxCpltCallback </td>
          <td>(</td>
          <td class="paramtype">UART_HandleTypeDef *&#160;</td>
          <td class="paramname"><em>huart</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called when a character is received from a uart. This char is stored as an array of rx_buff, with an index of 1. Will put the char in the correct buffer and check if the message is complete. Will reactivate the uart after char is handled. </p>
<dl class="section pre"><dt>Precondition</dt><dd>UARTS are turned on and waiting for interrupt. </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Char is stored and UART called under interrupt again. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">huart</td><td>The huart that called the callback </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a840291bc02cba5474a4cb46a9b9566fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840291bc02cba5474a4cb46a9b9566fe">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The application entry point. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">int</td><td></td></tr>
  </table>
  </dd>
</dl>
<h2><center> Supported Commands </center></h2>
<center></center> <h3>Addressing</h3>
<p>Format: <code>0 ADR 1</code><br  />
Definitions: <code>0</code> sends to <b>all</b> slaves. <code>ADR</code> is the addressing command. <code>1</code> is the first address.<br  />
<br  />
Used to give every slave a specific address down the chain.<br  />
 </p><h3>Turning On Slaves</h3>
<p>Format: <code>0 ON adr</code><br  />
Definitions: <code>0</code> sends to <b>all</b> slaves. <code>ON</code> is the turn on command. <code>adr</code> specifies which button is correct.<br  />
<br  />
This turns on the buttons of all slaves. Only the <code>adr</code> slave will have their buzzer ring.<br  />
 </p><h3>Turning Off Slaves</h3>
<p>Format: <code>0 OFF</code><br  />
Definitions: <code>0</code> sends to <b>all</b> slaves. <code>OFF</code> is the turn off command.<br  />
<br  />
 This command turns off all slaves, used <b>AFTER</b> the ON command.<br  />
 In reality, the slaves don't listen to the specific message, any message will do to turn them off.<br  />
 This is to prevent a missed "off" command to put the slave in blocking mode.<br  />
 The alternative would have been to set a timer in the slave to quit.<br  />
 This however decreases the amount of control the master could have over the slaves.<br  />
 This compromise had to be made, so that the master is still in control.<br  />
 </p><h3>Verify Connection</h3>
<p>Format: <code>adr ASK</code><br  />
Definitions: <code>adr</code> specifies which slave to send the command to. <code>ASK</code> is the command.<br  />
<br  />
 This command asks a specific slave to reply with an answer.<br  />
 This is used to verify the slave is still connected.<br  />
 <br  />
<br  />
 </p><dl class="section attention"><dt>Attention</dt><dd><center><b>New commands have a max length of 3 characters. This can be changed in the slave code.</b></center></dd></dl>
<p><br  />
</p><h2><center> State Machine </center></h2>
<h3>Start State</h3>
<p>Reads incoming messages from the screen module. Will switch to addressing state if message is received. Mode will indicate if full range of buttons is to be used or only half.</p>
<h3>Addressing State</h3>
<p>Will send a command to give an adress to each slave. If received "slave" back addressing successful. State will move to Choose if successful, Start if failed.</p>
<h3>Choosing State</h3>
<p>Will choose a random button based on mode. Mode was set by start state earlier. Has a check to make sure there won't be a div/0 error. Next state will be control or start depending on number of slaves.</p>
<h3>Control &amp; Verify State</h3>
<p>Controls the chosen button from Choose State. Sends out a message for all buttons to turn on. Specifies the address of chosen button to turn on its speakers. Reads which button is pressed, or if a timeout occurred. If the correct button is pressed, will choose a new button (state choose). If the button was incorrect, will end the game (state end). If no button was pressed in time, will verify connection (state error).</p>
<h3>Error State</h3>
<p>Error state will verify communication works with the chosen slave. If the slave does not answer to this check, an LED will indicate an error. No matter the result of the Comm test, the next state will always be END.</p>
<h3>End State</h3>
<p>The final state of the program. Will display the score once and then reset it, along with the screen. Next state will be returning to start.</p>

</div>
</div>
<a id="af75e49c23f7837b52a29915a0cf91208"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af75e49c23f7837b52a29915a0cf91208">&#9670;&nbsp;</a></span>SendCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char SendCommand </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Expanded version of the SendMessage command. This command calls SendMessage and if that succeeded calls CheckTimout. The user inputs what command they want to send, what answer they expect and how long to wait for a timeout. </p>
<dl class="section pre"><dt>Precondition</dt><dd>none </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Messages are sent to slaves. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmd</td><td>The string for the command to send to the slaves. </td></tr>
    <tr><td class="paramname">ans</td><td>The string for the expected answer from the slaves. </td></tr>
    <tr><td class="paramname">timeout</td><td>How long the process will wait for the expected answer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if success, 0 if failed. </dd></dl>

</div>
</div>
<a id="a76f45df70ed53a2b4c17aa3c60fff0d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a76f45df70ed53a2b4c17aa3c60fff0d1">&#9670;&nbsp;</a></span>SendMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char SendMessage </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a message to the slaves and waits for an acknowledge. </p>
<dl class="section pre"><dt>Precondition</dt><dd>none </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>Message has been sent </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The string to send to the slaves </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns 1 if acknowledge was received, else 0. </dd></dl>

</div>
</div>
<a id="a720d1625c6409023659f9515ce44d6e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a720d1625c6409023659f9515ce44d6e1">&#9670;&nbsp;</a></span>SetLed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SetLed </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>led_pin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Used to control the LEDs using global defines. Mostly useful for the blinking functionality. This activates a timer that will turn the LED off after 100ms. This makes it so LEDs can blink without halting the execution of the program. </p>
<dl class="section pre"><dt>Precondition</dt><dd>none </dd></dl>
<dl class="section post"><dt>Postcondition</dt><dd>LED state changed </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">led_pin</td><td>Which pin to toggle (Should use a define as input) </td></tr>
    <tr><td class="paramname">state</td><td>What state the LED should be. On/Off/Toggle or Blink </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a70af21c671abfcc773614a9a4f63d920"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70af21c671abfcc773614a9a4f63d920">&#9670;&nbsp;</a></span>SystemClock_Config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SystemClock_Config </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>System Clock Configuration. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Initializes the RCC Oscillators according to the specified parameters in the RCC_OscInitTypeDef structure.</p>
<p>Initializes the CPU, AHB and APB buses clocks</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a class="el" href="dir_b596f468b52957496e4f78b80e029268.html">Src</a></li><li class="navelem"><a class="el" href="main_8c.html">main.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
